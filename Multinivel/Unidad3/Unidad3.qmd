---
title: "Análisis multinivel aplicado a epidemiología"
subtitle: "Unidad 3"
format: 
  revealjs:
    slide-number: true
    theme: simple
    css: styles.css
    logo: logo_INE.PNG
    footer: "Instituto Nacional de Epidemiología"
editor: visual
---

## Definición y sinónimos {.smaller}

Técnicamente los modelos lineales multinivel son una extensión de los modelos lineales de regresión, donde se incorpora un segundo término aleatorio que nos permite:

-   estimar simultáneamente efectos de los diferentes niveles

-   considerar la no independencia de las observaciones al interior de grupos

-   examinar simultáneamente la variabilidad de los diferentes niveles

**Sinónimos:**

-   Modelos mixtos

-   Modelos jerárquicos

-   Modelos anidados

-   Modelos de efectos aleatorios

## Variabilidad en intercepto y la pendiente

![](images/modelos_aleatorios.PNG){fig-align="center"}

## Ecuación modelo lineal nulo

$$
Y_{i} = \beta_{0} + \epsilon_{i}
$$

$$
\epsilon_{i} \sim N(0, \sigma^2)
$$

![Ejemplo con 4 observaciones](images/modelo_lineal.PNG){fig-align="center"}

## Notación

<br>

| Término      | Significado                                         |
|--------------|-----------------------------------------------------|
| $Y_{i}$      | variable respuesta del individuo $i$                |
| $\beta_{0}$  | intercepto (media de $y$)                           |
| $\epsilon_i$ | error (residuos con distribución $N(0, \sigma^2)$ ) |

## Ecuación modelo multinivel nulo

Nivel 1

$$
Y_{ij} = \beta_{0j} + \epsilon_{ij}
$$

$$
\epsilon_{ij} \sim N(0, \sigma^2)
$$

Nivel 2

$$
\beta_{0j} = \gamma_{00} + U_{oj}
$$

$$
U_{oj} \sim N(0, \tau_{oj})
$$

## Gráficamente

![](images/modelo_multinivel_intercepto.PNG){fig-align="center"}

## Notación {.smaller}

| Término         | Significado                                                                                                              |
|-------------------------|-----------------------------------------------|
| $Y_{ij}$        | variable respuesta del individuo $i$ en el grupo $j$                                                                     |
| $\beta_{0j}$    | intercepto aleatorio (media de grupo)                                                                                    |
| $\gamma_{00}$   | media general de $y$ (para todos los grupos)                                                                             |
| $\epsilon_{ij}$ | error (residuos con distribución $N(0, \sigma^2)$ ) del individuo $i$ en el grupo $j$ respecto de la media del grupo $j$ |
| $U_{0j}$        | error (residuos con distribución $N(0, \tau^2)$ ) del grupo $j$ respecto de la media general $\gamma_{00}$               |

## Explicación {.smaller}

En este modelo de dos niveles, dividimos el residuo en dos componentes, correspondientes a los dos niveles en la estructura de datos.

La media de $y$ para el grupo $j$ es $\gamma_{00} + U_{0j}$, por lo que el residuo a nivel de grupo $U_{0j}$ es la diferencia entre la media del grupo $j$ y la media general. El residuo a nivel individual $\epsilon_{ij}$ es la diferencia entre el valor de $y$ para el i-ésimo individuo y la media del grupo de ese individuo, es decir, $\epsilon_{ij} = y_{ij} − (\gamma_{00} + U_{0j})$ .

Se supone que los residuos en ambos niveles siguen distribuciones normales con medias cero, por lo tanto, la varianza total se divide en dos componentes: la varianza entre grupos $\tau_{0j}$, basada en las desviaciones de las medias grupales de la media general, y la varianza entre individuos dentro del grupo $\sigma^2$, basada en las desviaciones individuales de las medias grupales. Por esta razón, el modelo a veces se denomina *modelo de componentes de varianza*.

## Coeficiente de Correlación Intraclase {.smaller}

<br>

-   En modelos simples es similar al **coeficiente de partición de varianza (VPC)**.

-   Mide el grado de dependencia de los individuos y permite evaluar la variabilidad entre y a traves de los grupos.

    $$ICC = \frac{\tau_{00}}{\tau_{00} + \sigma^2} $$

-   Varía de 0 (sin diferencias de grupo, es decir, $\tau_{00}=0$ ) a 1 (sin diferencias dentro del grupo, es decir, $\sigma^2=0$).

-   Si el ICC es 0,2, por ejemplo, diríamos que el 20% de la variación es entre grupos y el 80% entre individuos dentro de los grupos.

## ICC con varianzas similares

<br>

![](images/icc_medio.PNG){fig-align="center"}

$$ICC = \frac{\tau_{00}}{\tau_{00} + \sigma^2} = \frac{10}{10+10} = 0,5 $$

## ICC con mayor varianza intergrupos

![](images/icc_grande.PNG){fig-align="center"}

$$ICC = \frac{\tau_{00}}{\tau_{00} + \sigma^2} = \frac{40}{40+10} = 0,8 $$

## ICC con mayor varianza intragrupos

![](images/icc_chico.PNG){fig-align="center"}

$$ICC = \frac{\tau_{00}}{\tau_{00} + \sigma^2} = \frac{20}{20+40} = 0,33 $$

## Varianza explicada

<br>

Partir la varianza en sus diferentes componentes, nos permite entender cuanta varianza hay en cada nivel, comparada con el resto de los niveles.

<br>

También nos va a permitir ver como cambia la varianza en los diferentes niveles cuando incorporemos variables explicativas de cada uno.

## Inferencia para efecto de grupo {.smaller}

-   $H_0: \tau_{00} = 0$ (hipótesis nula es que no hay diferencias entre grupos)

-   Estadístico: **razón de verosimilitud** (LRT)

    $$
    LR = -2logL_1 - (-2logL_2) \sim \chi^2
    $$

-   El estadístico de prueba LRT se compara con una distribución de $\chi^2$ con grados de libertad iguales al número de parámetros adicionales en el modelo más complejo. En el caso del modelos de dos niveles, es la varianza entre grupos $\tau_{00}$, por lo que hay 1 grado de libertad.

-   El rechazo de la $H_0$ implica que existen diferencias de grupo "reales", en cuyo caso se prefiere el modelo multinivel al modelo de un solo nivel. Sin embargo, si fallamos en rechazar el nulo, estaría justificado ajustar un modelo de un solo nivel, pero solo después de una mayor exploración porque es posible que las diferencias entre grupos se revelen después de agregar variables explicativas

## Inferencia para efectos fijos

## Procedimiento de estimación

## Sintaxis en R

## Escritura de fórmulas

## Salida de R


- Modelo nulo (ICC + LRT)
- Iteración incorporando variables de nivel 1 y 2 (ICC + AIC + )
- 
## Estudios según unidad de análisis {.smaller}

::: panel-tabset
## Ecológicos

-   los grupos son las unidades de análisis.

-   variable dependiente e independientes se miden para los grupos

-   se examinan los factores a nivel de grupo asociados con la variabilidad de grupo a grupo en la variable dependiente

-   implican medir tasas de enfermedad para diferentes áreas y relacionarlas con las características socioambientales del área (medidas del ingreso medio del área) o características físicas del área (niveles de contaminación del aire).

-   no pueden examinar variables a nivel individual como factores de confusión o mediadores de la asociación ecológica observada.

## Individuos

-   los individuos son las unidades análisis

-   variable dependente e independientes se miden para los individuos

-   se examinan los factores a nivel de individual asociados con la variabilidad de individuos a individuo en la variable dependiente

-   relacionan características y comportamientos individuales a la probabilidad de desarrollar una enfermedad en un momento dado tiempo o durante un período de seguimiento.

-   se constituyen agrupamientos de individuos según características o exposición individual
:::

## Pensando en poblaciones

*Considero cada vez más útil hacer una distinción entre dos tipos de preguntas etiológicas. Las primeras buscan las causas de los casos y las segundas las causas de la incidencia.*

*"**¿Por qué algunos individuos sufren de hipertensión?**" es una pregunta que difiere bastante de "**¿por qué en algunas poblaciones es tan frecuente la hipertensión mientras que en otras es rara?**"*

*Estas preguntas exigen diferentes tipos de estudios y tienen distintas respuestas.*

::: aside
Rose, G. Sick Individuals and Sick Populations. Int J Epidemiol 1985
:::

## Pensando en poblaciones

![](images/Dist_hta.PNG){fig-align="center"}

::: aside
Rose, G. Sick Individuals and Sick Populations. Int J Epidemiol 1985
:::

## Pensando en poblaciones

<br>

*La pregunta habitual **"¿por qué algunos individuos tienen presión arterial más alta que otros?"** podría plantearse con igual propiedad en los dos medios, dado que en ambos la presión arterial de los individuos varía aproximadamente en la misma medida (proporcionalmente); y las respuestas bien podrían ser muy similares en los dos casos (es decir, principalmente por variabilidad genética, y en menor grado por diferencias ambientales y del comportamiento).*

::: aside
Rose, G. Sick Individuals and Sick Populations. Int J Epidemiol 1985
:::

## Pensando en poblaciones

<br>

*Podríamos llegar a comprender plenamente la causa de las diferencias entre los individuos y, no obstante, pasar completamente por alto la pregunta más importante para la salud pública: **"¿Por qué la hipertensión no existe en Kenya y es común en Londres?"***

::: aside
Rose, G. Sick Individuals and Sick Populations. Int J Epidemiol 1985
:::

## Pensando en poblaciones

*La respuesta a esta pregunta se vincula con los factores determinantes de la media de la población, puesto que lo que distingue a los dos grupos no depende en absoluto de las características de los individuos sino que es más bien un desplazamiento de la distribución en su conjunto: **una influencia masiva que actúa sobre toda la población**. Para encontrar los factores determinantes de las tasas de prevalencia e incidencia tenemos que estudiar las características de las poblaciones, no las de los individuos.*

::: aside
Rose, G. Sick Individuals and Sick Populations. Int J Epidemiol 1985
:::

## Problemas con niveles

La falta de reconocimiento de que las construcciones definidas en diferentes niveles pueden ser importantes en la comprensión de la variabilidad dentro de un nivel dado, y la incapacidad de distinguir adecuadamente los constructos definidos en diferentes niveles conduce a graves riesgos teóricos y técnicos.

Obviar el anidamiento de casos puede llevar a falacias interpretativas de diversa naturaleza, como las falacias ecológicas y atomista

## Falacias

<br>

**Falacia ecológica :** es la inferencia falsa que se hace cuando se deduce incorrectamente a nivel individual (es decir, acerca de la variabilidad interindividual) a partir de información a nivel grupal.

<br>

**Falacia atomista:** es la que puede surgir cuando se hacen inferencias sobre la variabilidad intergrupal (o la relación entre variables grupales) a partir de datos individuales.

## Gráficamente

![](images/falacia.png){fig-align="center" width="40%"}

## Composición del dato científico

1.  **Unidad de análisis**: entidades de estudio

2.  **Variables:** aspectos de las unidades análisis que se han seleccionado para estudiar.

3.  **Valores**: estados particulares que pueden asumir las variables.

4.  **Indicadores**: formas de medir o evaluar las variables seleccionadas (dimensiones)

::: aside
Juan Samaja - "Epistemología y Metodología. Elementos para una teoría de la investigación científica. Buenos Aires. Eudeba. 1993
:::

## Unidades y niveles

"La relación entre indicadores y variables remite a otro asunto igualmente relevante para la comprensión del proceso de construcción de los datos: la de las relaciones de **jerarquías entre niveles de análisis**."

Denomina "contexto" a los *niveles supra-unitarios* y *nivel focal o de anclaje* al del individuo, que tiene niveles sub-unitarios en función de la dimensiones componentes del nivel de anclaje.

::: aside
Juan Samaja - "Epistemología y Metodología. Elementos para una teoría de la investigación científica. Buenos Aires. Eudeba. 1993
:::

## Terminología

<br>

**Variables individuales:** refiere a variables que caracterizan a los individuos y se refieren a constructos individuales (por ejemplo, la edad o los ingresos personales).

<br>

**Variables grupales:** refiere a las variables que caracterizan a los grupos. A menudo se usan indistintamente los términos variables grupales, macrovariables, variables macro y variables ecológicas.

## Terminología {.smaller}

**Variables derivadas (agregadas)**: son un tipo de variables grupales que se construye agregando matemáticamente (por ejemplo, mediante una media o una proporción) las características de los individuos del grupo (por ejemplo, el porcentaje de personas analfabetas)

**Variables integrales:** son un tipo de variables grupales que no tienen ningún análogo individual y se refieren necesariamente a constructos grupales. Son ejemplos de variables integrales la existencia de ciertos tipos de leyes, el sistema político o económico, la desorganización social o la densidad de población.

**Variables ambientales:** en los estudios ecológicos y en el análisis multinivel se emplea a veces el término variables ambientales para referirse a mediciones grupales de exposiciones físicas o químicas. Las variables ambientales, así definidas, se han propuesto como tipo de variable grupal, diferente de las variables derivadas y de las variables integrales.

## Estructura de los datos

<br>

**2 niveles: *jerárquico o anidado***

<br>

![](images/Estudiantes_escuelas.PNG){fig-align="center"}

## Estructura de los datos

<br>

**3 niveles: *jerárquico o anidado***

<br>

![](images/Estudiantes_escuelas_3.PNG){fig-align="center"}

## Estructura de los datos

<br>

**2 niveles: *medidas repetidas (datos de panel)***

<br>

![](images/Repetitivas.PNG){fig-align="center"}

## Estructura de los datos

**No jerárquico**

**3 niveles: *clasificación cruzada con medidas repetidas***

<br>

![](images/Repetidas_cruzada.PNG){fig-align="center"}

## Nivel o variable: clasificación fija o aleatoria?

¿cuándo se debe tratar una variable como una clasificación o nivel en lugar de una variable explicativa?

**Clasificación fija**: sus valores son conocidos y tiene un pequeño número fijo de categorías. Se tratan como variables.

**Clasificación aleatoria**: corresponde a un nivel de la estructura de los datos. Sus unidades pueden considerarse como una muestra aleatoria de una población más amplia de unidades.

## Nivel o variable: clasificación fija o aleatoria?

::: {style="font-size: 80%"}
Supongamos que agregamos una clasificación de escuelas, como estatales y privadas.

¿Es tipo de escuelas un nivel (clasificación aleatoria) o una variable (clasificación fija)?
:::

![](images/Tipos_escuelas.PNG){fig-align="center" width="80%"}

## Nivel o variable: clasificación fija o aleatoria?

::: {style="font-size: 80%"}
El tipo de escuela tiene un pequeño número fijo de categorías. No hay una población más amplia de tipos de escuelas. Estatal y privada no son dos tipos muestreados de un gran número de tipos de escuelas, por lo que corresponde a una clasificación fija, y por eso trataríamos el tipo de escuela como una variable y no como un nivel.

La distinción entre clasificaciones fijas y aleatorias también está vinculada al concepto de objetivo de inferencia. Si quisieramos inferir a todas y cada una de las escuelas específicas como una elementos en sí mismo, entonces esta sería una clasificación fija. Usando una clasificación fija, podría estimar si la Escuela X es diferente en términos de progreso de la Escuela Z y la Escuela W, etc. Sin embargo, si el objetivo de la inferencia son las diferencias entre escuelas, entonces se debe usar la clasificación aleatoria.
:::

## Matriz de datos

Matriz para ejemplo anterior (2 niveles jerárquicos)

![](images/matriz_datos.PNG){fig-align="center"}

## La pregunta de investigación en el análisis multinivel

El abordaje multinivel permite responder preguntas para cada nivel y también sobre el efecto de variables de un nivel en variables de otro.

Ejemplos sobre la última estructura vista:

-   ¿Los hombres progresan más que las mujeres?

-   ¿Varía la brecha de género entre las escuelas?

-   ¿Los estudiantes progresan más en las escuelas privadas que en las públicas?

## Resumen

<br>

-   El mundo real tiene una estructura compleja y/o se la imponemos a través de nuestro diseño de investigación.

-   Las estructuras complejas tienden a crear dependencias entre las observaciones.

-   El modelado multinivel se ocupa de la estructura compleja que se deriva de la realidad y el diseño del estudio; modela explícitamente dependencias y hace frente a estructuras de datos desequilibradas

## 

<br>

<br>

::: {style="color: #00746B; font-size: 180%"}
En **epidemiología** la presencia de niveles múltiples y de estructuras anidadas y cruzadas en los datos es la norma (*y no la excepción*).
:::
