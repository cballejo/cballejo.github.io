---
title: "Introducci√≥n al an√°lisis de datos en R y RStudio"
subtitle: "Encuentro 1"
format: 
  revealjs:
    transition: slide
    slide-number: true
    theme: simple
    footer: "Residencia Medicina General"
editor: visual
---

## Objetivos

::: {style="font-size: 80%;"}

::: incremental
-   Comprender los conceptos fundamentales sobre estructura y organizaci√≥n de los datos en salud.
-   Instalar y configurar el entorno de trabajo con R, RStudio, Rtools y paquetes b√°sicos.
-   Explorar caracter√≠sticas relevantes del lenguaje R y tidyverse
-   Importar, explorar y describir conjuntos de datos en formato tabular.
-   Aplicar funciones b√°sicas del lenguaje R y del paquete tidyverse para gesti√≥n y an√°lisis descriptivo.
-   Calcular indicadores epidemiol√≥gicos simples ( incidencia, etc).
:::

:::

. . .

::: {style="font-size: 80%;"}

**Contacto:** [Christian Ballejo](mailto:christianballejo@gmail.com)

:::

## ¬øQu√© es un dato?

-   Unidad m√≠nima de informaci√≥n que describe una caracter√≠stica observable de una unidad de an√°lisis en la muestra o poblaci√≥n.
-   **Ejemplo:** la edad registrada en una historia cl√≠nica.

![](images/dato.JPG){fig-align="center"}

**Idea clave:** un dato s√≥lo tiene significado en su contexto (qui√©n, cu√°ndo, c√≥mo).

## Variable vs Valor

::::: columns
::: {.column width="65%"}
-   **Variable:** caracter√≠stica que puede variar entre observaciones. Se ubica en columnas y tiene un tipo de dato definido.
:::

::: {.column width="35%"}
![](images/variable.JPG){fig-align="center"}
:::
:::::

. . .

::: {style="font-size: 80%;"}
-   Ej.: edad, sexo, diagn√≥stico, fecha de consulta.
:::

. . .

::: {style="font-size: 90%;"}
-   **Valor:** manifestaci√≥n concreta de la variable para una unidad de an√°lisis.
-   Ej.: edad = 45 (num√©rico); sexo = F (caracter); fecha de consulta = 2025-11-28 (fecha).
:::

## Variables

![](images/operacionalizacion.jpg){fig-align="center"}

![](images/medicion.jpg){fig-align="center"}

## Unidad de an√°lisis

::::: columns
::: {.column width="60%"}
-   Entidad b√°sica sobre el que se registran los datos. Se ubica en las filas y constan de un conjunto de variables.
:::

::: {.column width="40%"}
![](images/observacion.JPG){fig-align="center"}
:::
:::::

-   Ejemplos en salud: **Paciente**, **Consulta**, **Evento** (p. ej. notificaci√≥n de enfermedad), **Hospital**, etc.

**Por qu√© importa:** la elecci√≥n condiciona el dise√±o, la agregaci√≥n, la dependencia y la interpretaci√≥n.

## Tipos de variables

::: {.fragment .fade-in-then-semi-out}
-   **Cuantitativas o num√©ricas** (Continuas: p. ej. edad, peso o discretas: p. ej. n√∫mero de consultas)
:::

::: {.fragment .fade-in-then-semi-out}
-   **Cualitativas o categ√≥ricas** (Nominales: p. ej. sexo, diagn√≥stico. u ordinales: p. ej. gravedad (leve/moderado/severo).
:::

::: {.fragment .fade-in-then-semi-out}
-   **Fechas / Tiempos** (Ej.: fecha de inicio de s√≠ntomas, fecha de notificaci√≥n).
:::

::: {.fragment .fade-in-then-semi-out}
-   **L√≥gicas** (dicot√≥micas Verdadero - Falso)
:::

## Tablas ordenadas (datos tabulares)

Llamamos ‚Äúdatos ordenados‚Äù (tidy data) cuando:

. . .

::: {style="font-size: 80%;"}
-   Cada variable est√° en una columna
:::

. . .

::: {style="font-size: 80%;"}
-   Cada observaci√≥n est√° en una fila y pertenece a una unidad de observaci√≥n.
:::

. . .

::: {style="font-size: 80%;"}
-   Cada celda del cruce entre una columna y una fila es un valor
:::

. . .

![](images/tidy.PNG){fig-align="center"}

## Archivos planos

::: incremental
-   Archivos que contiene tablas de datos
-   Est√°n construidos con solo texto (se puede abrir desde un Block de Notas)
-   Formato simple: cada fila = observaci√≥n, cada columna = variable.
-   Extensiones comunes: `.csv`, `.txt` (delimitado por comas, punto y coma o tabulador).
:::

. . .

**Ventajas:** interoperables y f√°ciles de leer en R (`readr::read_csv()`).

## Tablas relacionales (bases de datos)

-   **Estructura:** varias tablas vinculadas por variables identificadoras (claves).
    -   **Clave primaria:** identifica √∫nivocamente una observaci√≥n en su propia tabla
    -   **Clave for√°nea:** identifica un√≠vocamente una observaci√≥n en otra tabla

. . .

Ejemplo: `pacientes` (id_paciente) ‚Üî `consultas` (id_consulta, id_paciente).

**Ventaja:** evitar duplicaci√≥n y mantener consistencia en datos complejos.

## Metadatos

::: incremental
-   *"Datos sobre los datos":* describen origen, fecha, definiciones, responsable.
-   Incluyen a los diccionarios de datos (siempre deben acompa√±ar a las tablas de datos)
-   Ejemplos: fecha de actualizaci√≥n, fuente, variables derivadas, formato.
:::

. . .

**Por qu√© son cr√≠ticos?:** permiten interpretar correctamente y mantener trazabilidad.

## Diccionario de datos

::: {style="font-size: 80%;"}
Delimitador de variables: ;

Delimitador de decimales: ,

| Variable           |       Tipo | Descripci√≥n           | Valores posibles |
|--------------------|-----------:|-----------------------|------------------|
| id_caso            |   num√©rico | Identificador √∫nico   | 1,2,3...         |
| edad               |   num√©rico | Edad en a√±os          | 0‚Äì120            |
| sexo               | categ√≥rica | Sexo biol√≥gico        | M, F, O          |
| fecha_notificacion |      fecha | Fecha de notificaci√≥n | AAAA-MM-DD       |
| diagnostico        | categ√≥rica | C√≥digo CIE10          | Formato CIE10    |
:::

## Consejos cuando trabajamos con datos

<br>

1.  Definir claramente la **unidad de an√°lisis** antes de recolectar/analizar.
2.  Mantener un **diccionario de datos** actualizado (incluyendo variables construidas).
3.  Saber el **tipo de variable** para elegir an√°lisis y gr√°fico adecuado.
4.  Guardar metadatos y versi√≥n de los archivos.

## Lenguajes/softwares - interfaz GUI vs CLI

<br>

:::::: columns
:::: {.column width="55%"}
::: {style="font-size: 80%;"}
**GUI (Graphical User Interface):** curva de aprendizaje inicial muy r√°pida. Luego pierde capacidad de realizar tareas nuevas.

**CLI (Command Line Interface):** curva de aprendizaje lenta inicialmente, a largo plazo las posibilidades de combinar y automatizar procesos permite una versatilidad mucho mayor y por lo tanto un mayor potencial creativo.
:::
::::

::: {.column width="45%"}
<br>

![](images/gui_vs_cli.jpg){fig-align="center"}
:::
::::::

## Lenguaje R

![](images/R.png){.absolute top="0" left="900" width="110" height="80"}

<br>

::: {.fragment .fade-in-then-semi-out}
El lenguaje R es es un lenguaje de programaci√≥n interpretado, orientado a objetos, multiplataforma y open source pensado para el manejo de datos estad√≠sticos.
:::

::: {.fragment .fade-in-then-semi-out}
Se considera la *lingua franca* de la estad√≠stica.
:::

::: {.fragment .fade-in-then-semi-out}
El objetivo es comenzar a *‚Äúdecir cosas con los datos‚Äù* como un usuario del lenguaje (inicialmente no como un programador).
:::

## RStudio

![](images/RStudio.png){.absolute top="0" left="900" width="250" height="80"} <br>

-   **RStudio** es un *entorno de desarrollo integrado* (**IDE**) para el lenguaje estad√≠stico R.

. . .

-   Incluye una consola, un editor de sintaxis que apoya la ejecuci√≥n de c√≥digo, as√≠ como herramientas para el manejo de paquetes (librer√≠as), gr√°ficos y la gesti√≥n del espacio de trabajo.

. . .

-   Pertenece a la empresa **Posit** pero se distribuye bajo licencia gratuita y libre.

## Descarga e instalaci√≥n

<br>

-   **R:** lenguaje base (<https://cran.r-project.org>)
-   **RStudio:** entorno integrado de desarrollo (<https://posit.co/download/rstudio>)
-   **Rtools (Windows):** necesario para compilar paquetes (<https://cran.r-project.org/bin/windows/Rtools/>)

**Orden recomendado de instalaci√≥n:** R- Rtools - RStudio

## Proyectos y scripts

<br>

-   **Proyecto (.Rproj):** carpeta de trabajo asociada; facilita organizaci√≥n y rutas relativas.

. . .

-   **Script (.R):** archivo de texto con instrucciones para ejecutar en secuencia.

## Asignaciones y comentarios

<br>

Operador principal de asignaci√≥n: `<-`

```{r, echo=TRUE}
x <- 5 # Asigna el valor 5 a x

y <- x + 3 # Suma 3 al valor de x
```

<br>

**Comentarios:** `#` indica texto a la derecha no ejecutable. Se usa para documentar el script.

```{r, echo=TRUE}
# Esto es un comentario
```

## Operaciones b√°sicas y tuber√≠as

Operados aritm√©ticos b√°sicos

```{r, echo=TRUE}
2 + 3
4 * 5
(10 - 2) / 4
```

**Tuber√≠as (`|>` o `%>%`):** permiten encadenar operaciones de forma legible.

```{r, echo=TRUE, eval=FALSE}

library(dplyr)

datos |>
  filter(sexo == "F") |>
  summarise(media_edad = mean(edad, na.rm = TRUE))
```

## Otros operadores

::: {style="font-size: 80%;"}
-   **Operadores relacionales:**
    -   `==` igual
    -   `!=` no igual
    -   `>` mayor
    -   `<` menor
    -   etc
-   **Operadores l√≥gicos:**
    -   `&` AND
    -   `|` OR
    -   `!` NOT
    -   etc
:::

## Funciones

-   Las funciones encapsulan tareas repetitivas.

-   Todas las funciones devuelven algo. Datos, un resultado o una acci√≥n determinada.

-   La mayor√≠a necesitan de ciertos datos que se declaran dentro de la funci√≥n denominados argumentos. Algunos son obligatorios y otros opcionales.

```{r, echo=TRUE, eval=FALSE}
# Sintaxis general
funcion(argumento1, argumento2)


mean(edad, na.rm = TRUE)
```

## Valores especiales: perdidos (NA)

-   Representan datos ausentes o desconocidos. `N`ot `Available` (no disponible)

```{r, echo=TRUE}
x <- c(1, 2, NA, 4)
mean(x) ## Devuelve NA
mean(x, na.rm = TRUE) ## Ignora valores perdidos
```

üí° Siempre verificar la presencia de `NA` antes de c√°lculos o gr√°ficos.

## Paquetes (librer√≠as)

::::: columns
::: {.column width="55%"}
-   Extienden las funciones de R base.
-   Se instalan una vez, se cargan cada vez que se usan.

```{r, echo=TRUE, eval=FALSE}
# Instalar paquete
install.packages("tidyverse")

# Activar paquete
library(tidyverse)
```
:::

::: {.column width="45%"}
![](images/paquetes.PNG){fig-align="center"}
:::
:::::

üí° tidyverse agrupa herramientas clave: `dplyr`, `ggplot2`, `readr`, `tidyr`, `forcats`.

## tidyverse

![](images/hex-tidyverse.png){.absolute top="0" left="900" width="110" height="110"}

::: {.fragment .fade-in-then-semi-out}
-   Estructura ordenada de datos (tidy data)
:::

::: {.fragment .fade-in-then-semi-out}
-   Reutiliza las estructuras de datos mediante el uso de tuber√≠as
:::

::: {.fragment .fade-in-then-semi-out}
-   Resuelve problemas complejos combinando varias piezas sencillas
:::

::: {.fragment .fade-in-then-semi-out}
-   Dise√±ada para humanos incorporando una gram√°tica espec√≠fica al lenguaje (que ya posee una sintaxis estricta y una semantica que le otorga significado)
:::

## Estructuras de datos principales

<br>

::: {style="font-size: 80%;"}
| Estructura | Descripci√≥n | Ejemplo |
|-------------------------|---------------------------|--------------------|
| **Vector** | Conjunto de valores del mismo tipo | `c(1,2,3)` |
| **Data frame** | Tabla con columnas (variables) y filas (observaciones) | `data.frame(edad, sexo)` |

**Otras estructuras:** listas, arrays, matrices, etc.
:::

## Vectores

-   Son secuencias de elementos del mismo tipo de dato.

-   Tienen dos atributos principales: longitud y tipo de dato.

```{r, echo=TRUE}
# Crear vector num√©rico
edades <- c(34, 45, 29, 51)


# Acceder a elementos
edades[2] # segundo valor


# Operaciones
mean(edades)
```

## Data frames

Un dataframe (marco de datos), es similar a una tabla de datos construida por una colecci√≥n de vectores ubicados verticalmente que mantienen la integridad de sus filas

```{r, echo=TRUE, eval=FALSE}
pacientes <- data.frame(
id = 1:3,
sexo = c("F", "M", "F"),
edad = c(30, 45, 50)
)

```

```{r}
pacientes <- data.frame(
id = 1:3,
sexo = c("F", "M", "F"),
edad = c(30, 45, 50)
)

pacientes
```

## Ayuda

-   Todas las funciones del R base o de los paquetes vienen acompa√±adas con su respectiva documentaci√≥n.

-   Esta documentaci√≥n se puede visualizar en el panel Help de RStudio navegando como si fuese un navegador web.

-   La documentaci√≥n tiene una estructura que se repite: descripci√≥n, uso, argumentos, detalles, valores, ejemplos.

-   Tambi√©n se pueden hacer b√∫squedas en Google, foros especializados, como por ejemplo Stack Overflow o Rpubs, canales de slack y m√°s recientemente en IAs como chatGPT o Google Gemini.

## Lectura y escritura de datos planos

![](images/readr.png){.absolute top="0" left="900" width="110" height="110"}

<br>

El paquete readr se instala y activa cuando ejecutamos `library(tidyverse)`.

. . .

Contiene una familia de funciones que permiten leer y escribir archivos de texto plano separados como coma o alg√∫n otro caracter (tabulaci√≥n, punto y coma, etc)

. . .

Sus funciones de lectura comienzan todas con `read_`

. . .

Sus funciones de escritura comienzan con `write_`

## Lectura o importaci√≥n desde Excel

![](images/readxl.png){.absolute top="0" left="900" width="110" height="110"}

<br>

El paquete `readxl` se instala con tidyverse pero hay que activarlo aparte mediante `library(readxl)`.

. . .

Contiene funciones que permiten leer archivos de **Microsoft Excel**, tan extendidos en nuestro trabajo cotidiano.

. . .

La funci√≥n comod√≠n para leer, tanto formatos `.xls` como `.xlsx`, es `read_excel()`

## Exploraci√≥n

<br>

::: {.fragment .fade-in-then-semi-out}
El primer paso luego de leer o importar la tabla de datos es explorarla para conocer la estructura y sus tipos de variables
:::

::: {.fragment .fade-in-then-semi-out}
Es importante contar con los *metadatos* de la tabla al que llamaremos **diccionario de datos**.
:::

::: {.fragment .fade-in-then-semi-out}
La funci√≥n `glimpse()` de dplyr-tidyverse posibilitan explorar r√°pidamente las variables, sus tipos y valores, as√≠ tambi√©n como saber sus dimensiones.
:::

## Funciones resumen

El lenguaje R posee variadas funciones para obtener medidas resumen:

::::::: columns
:::: {.column width="50%"}
::: {style="font-size: 70%;"}
-   tendencia central
    -   media con `mean()`
    -   mediana con `median()`
-   posici√≥n
    -   m√≠nimo con `min()`
    -   m√°ximo con `max()`
    -   percentil o cuantil con `quantile()`
:::
::::

:::: {.column width="50%"}
::: {style="font-size: 70%;"}
-   dispersi√≥n
    -   varianza con `var()`
    -   desv√≠o estandar con `sd()`
    -   rango intercuat√≠lico con `IQR()`
:::
::::
:::::::

::: {style="font-size: 70%;"}
La mayor√≠a de estas funciones aplican en tipos de datos enteros (int), num√©ricos (dbl), fecha (date) y fecha - hora (ddtm).
:::

## Funciones resumen

Para variables cualitativas o categ√≥ricas hacemos tablas de frecuencia absolutas o relativas (porcentuales) con:

<br>

`count()` para frecuencias absolutas

`mutate(porcentaje = n/sum(n))` para frecuencias porcentuales

<br>

La funci√≥n `count()` y `mutate()` pertenecen al paquete **dplyr** del **tidyverse**.

## 5 funciones-verbo

El paquete **tidyverse** incluye a **dplyr** cuya finalidad es gestionar f√°cilmente tablas de datos. Lo hace a partir de 5 funciones-verbos b√°sicas:

::: {style="font-size: 80%;"}
-   `filter()` filtra un subconjunto de observaciones (filas) de una tabla de datos a partir de una condici√≥n

-   `select()` selecciona un subconjunto de variables (columnas) de una tabla de datos

-   `mutate()` crea nuevas variables o modifica las existentes

-   `summarise()` genera res√∫menes por variable

-   `arrange()` ordena la tabla de datos seg√∫n orden de variables
:::

## Divide y vencer√°s

<br>

Uno de los pilares del tidyverse dice *"resolver problemas complejos combinando varias piezas sencillas"*.

. . .

<br>

Lo logramos dividiendo el problema en subproblemas m√°s sencillos que podemos resolver mediante diferentes funciones, que luego se conectan mediante operadores de tuber√≠a para dar respuesta al problema original.

## Ejemplo pr√°ctico

```{r, echo=T, eval=FALSE}
datos |>  # <1>
  mutate(grupo_etario = cut_interval(edad, length = 10, closed = "left")) |> # <2>
  filter(edad > 20) |>  # <3>
  group_by(sexo, grupo_etario) |> # <4> 
  summarise(conteo = n()) # <5>
```

::: {style="font-size: 80%;"}
1.  Partimos desde la tabla de `datos`
2.  Creamos la nueva variable `grupo_etario` con intervalos regulares de 10 a√±os (cerrados a izquierda)
3.  Filtramos observaciones con `edad` mayor a 20 a√±os
4.  Agrupamos (estratificamos) por `sexo` y `grupo_etario`
5.  Resumimos haciendo un conteo en cada combinaci√≥n de `sexo` y `grupo_etario`.
:::

## Ejemplo pr√°ctico

<br>

```{r, echo=F}
library(tidyverse)
library(flextable)

datos <- read_csv("data/sisa_dengue.csv")

datos |>  
  mutate(grupo_etario = cut_interval(edad, length = 10, closed = "left"),
         sexo = if_else(sexo == "F", "Mujer", "Var√≥n")) |> 
  filter(edad > 20) |>  
  group_by(sexo, grupo_etario) |> 
  summarise(conteo = n()) |> 
  pivot_wider(names_from = sexo, values_from = conteo) |> 
  flextable() |> 
  fontsize(size = 18, part = "all")
```

## Trabajo pr√°ctico

**Objetivo:** Aplicar lo aprendido a un conjunto de datos provisto, vinculando los resultados con un problema de salud simulado.

::: {style="font-size: 80%;"}

- Leer la tabla con datos de salud indicada.
- Explorar y depurar los datos.
- Crear nuevas variables 
- Calcular estad√≠sticos resumen de edad, sexo, etc.
- Calcular indicadores (incidencia acumulada y letalidad)
- Elaborar al menos dos gr√°ficos descriptivos.
- Presentar el script comentado y un breve resumen de resultados (1‚Äì2 p√°ginas).

:::

## Materiales

- [Consejos sobre tabla de datos en Excel](https://drive.google.com/file/d/15fYBNGRZ-zpHYz1IMEXWUQxWpkIa3V-p/view?usp=sharing)

- [Resumen funciones](https://drive.google.com/file/d/1EHmqHFJGlg17Z-te43jV0BHY6VITzPGa/view?usp=sharing)

- [Consigna TP - parte 1](https://drive.google.com/file/d/1tVFwCo7j8FrSadYIrDF-U22KqjXWZ2Tc/view?usp=sharing)

- [Tabla de datos SISA dengue](https://drive.google.com/file/d/1NowycKLpy2OqR91VroileUKuUaaRN1Uc/view?usp=sharing)

Comprimir la carpeta con el proyecto de RStudio y el script con la resoluci√≥n del trabajo pr√°ctico.

Enviar el archivo comprimido a <christianballejo@gmail.com> antes del pr√≥ximo encuentro.

## Bibliograf√≠a

<br>

[R para la Ciencia de Datos (2e)](https://davidrsch.github.io/r4ds-es/)

[Fundamentos de ciencia de datos con R](https://cdr-book.github.io/index.html)

[EpiRhandbook](https://epirhandbook.com/es/index.es.html)

[Data Visualization](https://socviz.co/)

[Big Book of R](https://www.bigbookofr.com/)

## Para descargar

<br>
<br>
<br>
<br>
[Mi_primer_script.R](https://drive.google.com/file/d/17PYc7W_2xnqCkewiJyx1iOh2d2Gfg7J-/view?usp=sharing)

[Datos sisa_covid.txt](https://drive.google.com/file/d/1e2Mz0TR5xiCbAqQ6--PKEs-fyCNEsjY1/view?usp=sharing)
